plugins {
    id("com.github.johnrengelman.shadow") version "7.0.0"
    id("io.micronaut.application") version "2.0.6"
}

version = "0.1"
group = "name.hergeth"

repositories {
    mavenCentral()
}

micronaut {
    runtime("netty")
    testRuntime("junit5")
    processing {
        incremental(true)
        annotations("name.hergeth.*")
    }
}

dependencies {
    compileOnly 'org.projectlombok:lombok:1.18.20'
    annotationProcessor 'org.projectlombok:lombok:1.18.20'

    testCompileOnly 'org.projectlombok:lombok:1.18.20'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.20'

    annotationProcessor "io.micronaut:micronaut-inject-java"
    annotationProcessor('io.micronaut.security:micronaut-security-annotations:3.0.0')

    annotationProcessor("io.micronaut:micronaut-http-validation")
    implementation("io.micronaut.security:micronaut-security-annotations")
    implementation("io.micronaut.security:micronaut-security-jwt")

    // google: guava, gson
//    implementation("com.google.guava:guava")
    implementation 'com.google.code.gson:gson:2.8.8'

    // reactor
    implementation platform('io.projectreactor:reactor-bom:2020.0.11')
    implementation 'io.projectreactor:reactor-core'
    implementation 'io.micronaut.reactor:micronaut-reactor:2.0.0'
    implementation 'io.micronaut.reactor:micronaut-reactor-http-client:2.0.0'

    // https://mvnrepository.com/artifact/org.apache.directory.api/api-all
    implementation group: 'org.apache.directory.api', name: 'api-all', version: '2.1.0'
// https://mvnrepository.com/artifact/org.wso2.orbit.org.apache.commons/commons-compress
    implementation 'org.wso2.orbit.org.apache.commons:commons-compress:1.18.0.wso2v1'
    // Apache commons
    compileOnly "org.apache.commons:commons-email:1.5"
    compileOnly "commons-validator:commons-validator:1.7"
    // https://mvnrepository.com/artifact/org.apache.commons/commons-text
    implementation group: 'org.apache.commons', name: 'commons-text', version: '1.9'

// https://mvnrepository.com/artifact/commons-io/commons-io
//    implementation 'commons-io:commons-io:20030203.000550'
    compileOnly 'commons-io:commons-io:2.11.0'

    // https://mvnrepository.com/artifact/com.github.lookfirst/sardine
    implementation group: 'com.github.lookfirst', name: 'sardine', version: '5.10'
    // jackson and xml
    implementation("io.micronaut.xml:micronaut-jackson-xml")

    // micronaut:
    implementation("io.micronaut:micronaut-http-client")
    implementation("io.micronaut:micronaut-runtime")
    implementation("javax.annotation:javax.annotation-api")
    implementation('io.micronaut.security:micronaut-security-jwt')
    runtimeOnly("ch.qos.logback:logback-classic")
    implementation("io.micronaut:micronaut-validation")

}


application {
    mainClass.set("name.hergeth.Application")
}
java {
    sourceCompatibility = JavaVersion.toVersion("11")
    targetCompatibility = JavaVersion.toVersion("11")
}

// generate a small Java class holding the current version from gradle.properties
task genJavaVer(type:Copy) {
    group = 'Generate Java Source'
    description = 'Generates the java source to display the version in the application.'

    def javaSrcContext = [version: project.version]
    inputs.properties javaSrcContext // for gradle up-to-date check
    from 'src/template/java'
    into "$buildDir/generated/java"
    expand javaSrcContext
}
sourceSets.main.java.srcDir "$buildDir/generated/java" // add the extra source dir
compileJava.dependsOn genJavaVer // wire the generateJava task into the DAG


